<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>平台使用教程 - HPC平台</title>
    <style>
        /* 统一CSS变量 - 与index.html完全一致 */
        :root {
            --primary-light: #f0f7ff;
            --primary: #e6f2ff;
            --secondary: #d1e8ff;
            --accent: #3182ce;
            --accent-dark: #2c5282;
            --text-dark: #1a365d;
            --text-light: #4a5568;
            --border: rgba(49, 130, 206, 0.15);
            --white: #ffffff;
            --shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 10px 25px rgba(49, 130, 206, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            color: var(--text-dark);
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            gap: 2rem;
            position: relative;
        }

        .main-content {
            flex: 1; /* 占满剩余空间 */
            min-width: 0; /* 防止flex项目溢出 */
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--accent);
            text-decoration: none;
            font-weight: 500;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            border: 1px solid rgba(66, 153, 225, 0.3);
            background: var(--white);
        }

        .back-btn:hover {
            background: var(--primary);
            border-color: var(--accent);
        }

        .page-header {
            background: var(--white);
            border-radius: 24px;
            padding: 3rem 2.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            text-align: center;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--text-dark);
            font-weight: 700;
        }

        .subtitle {
            font-size: 1.1rem;
            color: var(--text-light);
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .tutorial-content {
            background: var(--white);
            border-radius: 24px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .tutorial-section {
            margin-bottom: 2.5rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border);
        }

        .tutorial-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .tutorial-section h2 {
            color: var(--accent);
            margin-bottom: 1.2rem;
            font-size: 1.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .tutorial-section h3 {
            color: var(--accent-dark);
            margin: 1.5rem 0 0.8rem 0;
            font-size: 1.4rem;
            font-weight: 600;
            padding-left: 1rem;
            border-left: 4px solid var(--accent);
        }

        .tutorial-section h4 {
            color: var(--text-dark);
            margin: 1.2rem 0 0.6rem 0;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .tutorial-section h2 i {
            color: var(--accent-dark);
        }

        .tutorial-section p {
            line-height: 1.8;
            margin-bottom: 1rem;
            color: var(--text-light);
            font-size: 1.05rem;
        }

        .tutorial-section ul {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
            color: var(--text-light);
            line-height: 1.8;
        }

        .tutorial-section ol {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
            color: var(--text-light);
            line-height: 1.8;
        }

        .tutorial-section li {
            margin-bottom: 0.5rem;
        }

        .code-block {
            background: #1e1e1e;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            overflow-x: auto;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.95rem;
            border-left: 4px solid var(--accent);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .code-block pre {
            color: #d4d4d4;
            line-height: 1.6;
            white-space: pre-wrap;
            margin: 0;
        }

        .code-block .comment {
            color: #6a9955;
        }

        .code-block .command {
            color: #9cdcfe;
        }

        .code-block .path {
            color: #ce9178;
        }

        .code-block .keyword {
            color: #c586c0;
        }

        .image-container {
            margin: 1.5rem 0;
            text-align: center;
            background: var(--primary);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border);
        }

        .image-container img {
            max-width: 100%;
            border-radius: 8px;
            border: 1px solid var(--border);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .image-container img:hover {
            transform: scale(1.02);
        }

        .image-container .caption {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-top: 0.8rem;
            font-style: italic;
        }

        .alert {
            background: linear-gradient(135deg, #fff5e6 0%, #ffe8cc 100%);
            border-left: 4px solid #ed8936;
            padding: 1.2rem;
            margin: 1.5rem 0;
            border-radius: 0 12px 12px 0;
            display: flex;
            align-items: flex-start;
            gap: 0.8rem;
        }

        .alert i {
            color: #ed8936;
            font-size: 1.2rem;
            margin-top: 0.2rem;
        }

        .alert p {
            margin: 0;
            color: #744210;
            font-weight: 500;
        }

        .alert.warning {
            background: linear-gradient(135deg, #fff5f5 0%, #fed7d7 100%);
            border-left: 4px solid #f56565;
        }

        .alert.warning i {
            color: #f56565;
        }

        .alert.warning p {
            color: #742a2a;
        }

        .alert.info {
            background: linear-gradient(135deg, #e6fffa 0%, #b2f5ea 100%);
            border-left: 4px solid #38b2ac;
        }

        .alert.info i {
            color: #38b2ac;
        }

        .alert.info p {
            color: #234e52;
        }

        .nav-links {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .nav-link {
            background: var(--white);
            color: var(--accent);
            text-decoration: none;
            padding: 0.8rem 1.5rem;
            border-radius: 12px;
            transition: all 0.3s ease;
            border: 1px solid var(--border);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
        }

        .nav-link:hover {
            background: var(--primary);
            border-color: var(--accent);
            color: var(--accent-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .nav-link i {
            margin-right: 0.3rem;
        }

        .footer {
            text-align: center;
            padding: 3rem 0 1.5rem;
            color: var(--text-light);
            font-size: 0.95rem;
            border-top: 1px solid var(--border);
            margin-top: 3rem;
            background: var(--white);
            border-radius: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .footer strong {
            color: var(--text-dark);
        }

        /* 目录样式 - 修改为固定小宽度 */
        .toc-container {
            width: 250px; /* 稍微加宽一点以容纳子项 */
            position: sticky;
            top: 2rem;
            height: fit-content;
            background: var(--white);
            border-radius: 24px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            max-height: calc(100vh - 4rem);
            overflow-y: auto;
            flex-shrink: 0; /* 防止缩小 */
        }

        .toc-title {
            font-size: 1.1rem;
            color: var(--accent);
            margin-bottom: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }

        .toc-list {
            list-style: none;
        }

        .toc-item {
            margin-bottom: 0.5rem;
        }

        .toc-item.main {
            font-weight: 600;
            margin-top: 0.8rem;
        }

        .toc-item.sub {
            margin-left: 1.2rem;
            font-size: 0.85rem;
            margin-bottom: 0.4rem;
        }

        .toc-item.active {
            border-left-color: var(--accent);
            background: var(--primary-light);
            border-radius: 0 8px 8px 0;
        }

        .toc-link {
            color: var(--text-light);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem;
            border-radius: 6px;
            transition: all 0.2s ease;
            font-size: 0.9rem; /* 稍小字号 */
            white-space: nowrap; /* 防止换行 */
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .toc-link:hover {
            color: var(--accent);
            background: var(--primary);
        }

        .toc-item.active .toc-link {
            color: var(--accent-dark);
            font-weight: 600;
        }

        .toc-link i {
            font-size: 0.7rem;
            opacity: 0.7;
        }

        .toc-back-to-top {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
            text-align: center;
        }

        .toc-back-to-top a {
            color: var(--accent);
            text-decoration: none;
            font-size: 0.85rem;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            background: var(--primary);
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .toc-back-to-top a:hover {
            background: var(--accent);
            color: var(--white);
        }

        /* 图片放大模态框样式 */
        .image-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.9);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            margin: auto;
            display: block;
            max-width: 90%;
            max-height: 90%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border-radius: 8px;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.5);
            animation: zoomIn 0.3s;
        }

        @keyframes zoomIn {
            from { transform: translate(-50%, -50%) scale(0.8); }
            to { transform: translate(-50%, -50%) scale(1); }
        }

        .modal-content.zoomed {
            cursor: zoom-out;
            transform-origin: center center;
        }

        .modal-caption {
            margin: auto;
            display: block;
            width: 100%;
            max-width: 90%;
            text-align: center;
            color: #fff;
            padding: 10px 0;
            font-size: 1rem;
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 5px;
            backdrop-filter: blur(5px);
        }

        .modal-close {
            position: fixed;
            top: 20px;
            right: 30px;
            color: #fff;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            z-index: 1001;
            background-color: rgba(0, 0, 0, 0.5);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }

        .modal-controls {
            position: fixed;
            bottom: 20px;
            right: 30px;
            z-index: 1001;
            display: flex;
            gap: 10px;
        }

        .control-btn {
            background-color: rgba(0, 0, 0, 0.5);
            color: #fff;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        /* 加载动画 */
        .loading-spinner {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-size: 24px;
            z-index: 1002;
        }

        /* 响应式设计 - 在小屏幕上隐藏目录 */
        @media (max-width: 1200px) {
            .toc-container {
                display: none; /* 在中等屏幕上隐藏目录 */
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            .container {
                padding: 0;
            }

            .page-header {
                padding: 2rem 1.5rem;
            }

            h1 {
                font-size: 2rem;
            }

            .tutorial-content {
                padding: 1.5rem;
            }

            .tutorial-section h2 {
                font-size: 1.5rem;
            }

            .tutorial-section h3 {
                font-size: 1.2rem;
            }

            .code-block {
                padding: 1rem;
            }
            
            .modal-content {
                max-width: 95%;
                max-height: 80%;
            }
            
            .modal-close {
                top: 10px;
                right: 15px;
                font-size: 24px;
            }
            
            .modal-controls {
                bottom: 10px;
                right: 15px;
            }
        }

        /* 链接样式 */
        a.software-link {
            color: var(--accent);
            text-decoration: none;
            font-weight: 600;
            transition: color 0.2s ease;
            border-bottom: 1px dotted var(--accent);
        }

        a.software-link:hover {
            color: var(--accent-dark);
            border-bottom: 1px solid var(--accent-dark);
        }
        
        /* 为h3添加锚点目标 */
        h3[id] {
            scroll-margin-top: 80px; /* 为锚点跳转添加偏移，避免被固定目录遮挡 */
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- 主要内容区域 - 占满剩余空间 -->
        <div class="main-content">
            <a href="index.html" class="back-btn">
                <i class="fas fa-arrow-left"></i> 返回主界面
            </a>

            <div class="page-header">
                <h1>平台使用教程</h1>
                <p class="subtitle">
                    详细指导如何使用国家家养动物种质资源库HPC平台进行科研计算
                </p>
            </div>

            <div class="tutorial-content">
                <!-- 一、新用户注册部分 -->
                <div class="tutorial-section" id="section-register">
                    <h2><i class="fas fa-user-plus"></i> 一、新用户注册</h2>
                    
                    <h3 id="register-1">1. 访问登录注册界面</h3>
                    <p>新用户请访问以下地址进入登录注册界面：</p>
                    
                    <div class="code-block">
                        <pre><span class="command">访问地址：</span><span class="path">http://10.11.29.20/login</span></pre>
                    </div>
                    
                    <p>访问该地址后，您将看到平台的登录注册页面：</p>
                    
                    <div class="image-container">
                        <img src="fig/新用户注册.png" alt="新用户注册界面">
                        <div class="caption">图1：新用户注册界面</div>
                    </div>
                    
                    <h3 id="register-2">2. 填写注册信息</h3>
                    <p>点击注册按钮后，需要填写以下信息：</p>
                    <ul>
                        <li><strong>用户名：</strong>用于登录平台的唯一标识</li>
                        <li><strong>密码：</strong>设置登录密码（建议使用强密码）</li>
                        <li><strong>姓名：</strong>您的真实姓名</li>
                        <li><strong>手机号：</strong>用于接收重要通知</li>
                        <li><strong>邮箱：</strong>用于验证和接收系统通知</li>
                    </ul>
                    
                    <p>所有信息填写完毕后，点击提交注册申请：</p>
                    
                    <div class="image-container">
                        <img src="fig/新用户注册2.png" alt="新用户注册表单">
                        <div class="caption">图2：新用户注册信息填写界面</div>
                    </div>
                    
                    <div class="alert">
                        <i class="fas fa-info-circle"></i>
                        <p><strong>重要提示：</strong> 提交注册信息后，需要等待管理员审核。审核通过后，您才能使用账户登录平台。</p>
                    </div>

                </div>

                <!-- 二、用户登录部分 -->
                <div class="tutorial-section" id="section1">
                    <h2><i class="fas fa-sign-in-alt"></i> 二、用户登录</h2>
                    
                    <h3 id="login-1">1. 访问登录界面</h3>
                    <p>用户访问以下地址进入登录界面，输入用户名和密码登录平台：</p>
                    
                    <div class="code-block">
                        <pre><span class="command">访问地址：</span><span class="path">http://10.11.29.20/login</span></pre>
                    </div>
                    
                    <h3 id="login-2">2. 查看用户信息</h3>
                    <p>登录成功后，首页界面可以查看当前账号的简略信息，包括账户状态、使用情况等：</p>
                    
                    <div class="image-container">
                        <img src="fig/用户登录01.png" alt="用户登录后首页界面">
                        <div class="caption">图3：用户登录后首页界面，显示账户简略信息</div>
                    </div>
                    
                    <h3 id="login-3">3. 切换到HPC工作台</h3>
                    <p>点击页面左上角的9个点（应用菜单），选择切换到HPC工作台：</p>
                    
                    <div class="image-container">
                        <img src="fig/用户登录02.png" alt="点击9个点菜单">
                        <div class="caption">图4：点击左上角9个点打开应用菜单</div>
                    </div>
                    
                    <div class="image-container">
                        <img src="fig/用户登录03.png" alt="HPC工作台界面">
                        <div class="caption">图5：HPC工作台界面</div>
                    </div>
                    
                    <h3 id="login-4">4. 订阅所需软件</h3>
                    <p>在HPC工作台中，点击"订阅更多"按钮，订阅您需要使用的软件：</p>
                    
                    <div class="image-container">
                        <img src="fig/用户登录04.png" alt="订阅软件界面">
                        <div class="caption">图6：点击"订阅更多"按钮订阅所需软件</div>
                    </div>
                    
                    <div class="alert">
                        <i class="fas fa-lightbulb"></i>
                        <p><strong>提示：</strong> 首次使用平台时，请先订阅您需要的软件模块，然后才能在计算任务中使用这些软件。</p>
                    </div>
                </div>

                <!-- 三、网页平台提交命令部分 -->
                <div class="tutorial-section" id="section2">
                    <h2><i class="fas fa-terminal"></i> 三、网页平台提交命令</h2>
                    
                    <h3 id="web-submit-1">1. 订阅科学计算模块</h3>
                    <p>首次在网页平台提交计算命令前，需要先订阅科学计算模块。请确保您已完成第二部分的第4步"订阅所需软件"。</p>
                    
                    <div class="alert">
                        <i class="fas fa-exclamation-circle"></i>
                        <p><strong>重要：</strong> 如果没有订阅科学计算模块，将无法通过网页平台提交计算任务。</p>
                    </div>
                    
                    <h3 id="web-submit-2">2. 提交计算命令</h3>
                    <p>按照以下步骤在网页平台提交计算命令：</p>
                    
                    <ul>
                        <li><strong>回到HPC工作台：</strong>确保您在HPC工作台界面</li>
                        <li><strong>点击SBASE图标：</strong>在工作台中找到并点击SBASE应用图标</li>
                        <li><strong>选择工作目录：</strong>选择工作目录为用户文件目录</li>
                        <li><strong>填写具体命令：</strong>在命令输入框中填写要执行的命令</li>
                    </ul>
                    
                    <p><strong>命令示例：</strong></p>
                    
                    <div class="code-block">
                        <pre><span class="comment"># 简单测试命令</span>
<span class="command">sleep</span> 50

<span class="comment"># 具体软件命令（使用绝对路径）</span>
<span class="path">/var/ty-root/users/software/miniconda3/envs/common/bin/plink</span> <span class="keyword">--help</span></pre>
                    </div>
                    
                    <h3 id="web-submit-3">3. 配置计算资源</h3>
                    <p>填写命令后，还需要配置以下计算资源参数：</p>
                    
                    <ul>
                        <li><strong>选择分区：</strong>选择适合您任务的计算分区</li>
                        <li><strong>所需CPU数量：</strong>指定任务需要的CPU核心数</li>
                        <li><strong>所需内存数量：</strong>指定任务需要的内存大小</li>
                        <li><strong>所需运行时限：</strong>设置任务的预计运行时间</li>
                    </ul>
                    
                    <h3 id="web-submit-4">4. 提交任务</h3>
                    <p>所有参数配置完成后，点击"提交"按钮提交计算任务：</p>
                    
                    <div class="image-container">
                        <img src="fig/平台计算01.png" alt="网页平台提交命令界面">
                        <div class="caption">图7：网页平台提交命令界面 - 填写命令和配置资源参数</div>
                    </div>
                    
                    <div class="alert">
                        <i class="fas fa-lightbulb"></i>
                        <p><strong>提示：</strong> 任务提交后，系统会返回一个作业ID。您可以在作业监控页面查看任务状态和输出结果。</p>
                    </div>
                </div>

                <!-- 四、命令行提交命令部分 -->
                <div class="tutorial-section" id="section3">
                    <h2><i class="fas fa-terminal"></i> 四、命令行提交命令</h2>
                    
                    <h3 id="cli-1">1. SSH登录集群</h3>
                    <p>使用SSH客户端软件连接到HPC集群：</p>
                    
                    <div class="code-block">
                        <pre><span class="comment"># SSH连接命令</span>
<span class="command">ssh</span> <span class="path">your_username</span>@<span class="path">10.11.29.21</span> -p <span class="path">22</span>

<span class="comment"># 或者使用简化的形式</span>
<span class="command">ssh</span> -p <span class="path">22</span> <span class="path">your_username@10.11.29.21</span></pre>
                    </div>
                    
                    <p>连接参数说明：</p>
                    <ul>
                        <li><strong>IP地址：</strong>10.11.29.21</li>
                        <li><strong>端口：</strong>22（默认SSH端口）</li>
                        <li><strong>用户名：</strong>您在平台注册的用户名</li>
                    </ul>
                    
                    <h3 id="cli-2">2. 查看已安装软件</h3>
                    <p>登录成功后，您可以在命令行查看和使用已安装的软件。</p>
                    <p>已安装的软件及调用方法请查看：<a href="software_list.html" class="software-link">已安装软件列表</a>（点击查看详情）</p>
                    
                    <h3 id="cli-3">3. 使用sbatch提交命令</h3>
                    <p>在命令行使用sbatch命令提交计算任务：</p>
                    
                    <div class="code-block">
                        <pre><span class="comment"># 示例1：简单测试命令</span>
<span class="command">sbatch</span> -J test -p x86-shou -c 2 --mem=5G --time=0 -o test_%j.out -e test_%j.err --wrap="sleep 50"

<span class="comment"># 示例2：具体软件命令</span>
<span class="command">sbatch</span> -J test -p x86-shou -c 2 --mem=5G --time=0 -o test_%j.out -e test_%j.err --wrap="/var/ty-root/users/software/miniconda3/envs/common/bin/plink --help"</pre>
                    </div>
                    
                    <p><strong>参数说明：</strong></p>
                    <ul>
                        <li><strong>-J：</strong>任务名字（job name）</li>
                        <li><strong>-p：</strong>选择计算分区（partition）</li>
                        <li><strong>-c：</strong>选择CPU核心数</li>
                        <li><strong>--mem：</strong>选择内存大小</li>
                        <li><strong>--time：</strong>选择所需运行时限（0表示无限制）</li>
                        <li><strong>-o：</strong>软件正常输出结果文件</li>
                        <li><strong>-e：</strong>报错信息输出文件</li>
                        <li><strong>--wrap：</strong>需要运行的生信软件命令</li>
                    </ul>
                    
                    <div class="image-container">
                        <img src="fig/命令行计算01.png" alt="命令行提交命令示例">
                        <div class="caption">图8：命令行提交命令界面示例</div>
                    </div>
                    
                    <div class="alert warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p><strong>重要警告：</strong> 在命令行所有软件均需使用sbatch提交到计算节点运行，不允许在登录节点直接运行命令！一经发现，将会直接kill掉运行的命令！</p>
                    </div>
                    
                    <h3 id="cli-4">4. 提交作业脚本文件</h3>
                    <p>正在编写脚本中......</p>
                    <div class="code-block">
                        <pre><span class="command">正在编写脚本中</span> <span class="path">......</span></pre>
                    </div>
                </div>

                <!-- 五、命令运行情况查看部分 -->
                <div class="tutorial-section" id="section4">
                    <h2><i class="fas fa-eye"></i> 五、命令运行情况查看</h2>
                    
                    <h3 id="monitor-1">1. 网页端查看运行情况</h3>
                    <p>对于第三部分（网页平台提交命令）和第四部分（命令行提交命令）提交的命令，均可以回到网页端查看运行情况。</p>
                    
                    <p>在HPC工作台中，您可以查看所有已提交作业的状态、运行时间、资源使用情况等信息：</p>
                    
                    <div class="image-container">
                        <img src="fig/命令运行情况查看01.png" alt="网页端查看命令运行情况">
                        <div class="caption">图9：网页端查看命令运行情况</div>
                    </div>
                    
                    <h3 id="monitor-2">2. 查看作业详细信息</h3>
                    <p>点击具体的作业ID或作业名称，可以查看该作业的详细信息：</p>
                    
                    <ul>
                        <li><strong>作业基本信息：</strong>作业ID、名称、状态、提交时间、运行时间等</li>
                        <li><strong>资源使用情况：</strong>CPU使用率、内存使用量、运行节点等</li>
                        <li><strong>标准输出数据：</strong>查看作业的标准输出内容</li>
                        <li><strong>错误输出信息：</strong>查看作业的错误日志和警告信息</li>
                    </ul>
                    
                    <div class="image-container">
                        <img src="fig/命令运行情况查看02.png" alt="作业详细信息查看">
                        <div class="caption">图10：点击具体作业查看详细信息</div>
                    </div>
                    
                    <div class="alert info">
                        <i class="fas fa-info-circle"></i>
                        <p><strong>提示：</strong> 您可以根据作业的输出信息和错误日志来调试程序，优化计算参数，提高计算效率。</p>
                    </div>
                </div>

                <!-- 六、特殊软件使用教程部分 -->
                <div class="tutorial-section" id="section5">
                    <h2><i class="fas fa-laptop-code"></i> 六、特殊软件使用教程</h2>
                    
                    <h3 id="special-1">1. 已安装软件列表</h3>
                    <p>已安装的软件及调用方法请查看：<a href="software_list.html" class="software-link">已安装软件列表</a>（点击查看详情）</p>
                    
                    <h3 id="special-2">2. JupyterLab使用教程</h3>
                    
                    <h4>（1）订阅JupyterLab</h4>
                    <p>在应用中心订阅JupyterLab服务。</p>
                    
                    <h4>（2）配置并提交JupyterLab作业</h4>
                    <p>在HPC工作台点击JupyterLab应用图标，配置以下参数：</p>
                    <ul>
                        <li><strong>选择分区：</strong>选择适合的计算分区</li>
                        <li><strong>CPU数量：</strong>指定需要的CPU核心数</li>
                        <li><strong>内存数量：</strong>指定需要的内存大小</li>
                        <li><strong>运行时限：</strong>设置JupyterLab的运行时间</li>
                    </ul>
                    <p>所有参数配置完成后，点击提交按钮：</p>
                    
                    <div class="image-container">
                        <img src="fig/JupyterLab软件01.png" alt="JupyterLab配置界面">
                        <div class="caption">图11：JupyterLab配置和提交界面</div>
                    </div>
                    
                    <h4>（3）启动并访问JupyterLab</h4>
                    <p>等待3-5分钟，在HPC工作台的"我的应用"中即可看到JupyterLab应用，点击即可进入：</p>
                    
                    <div class="image-container">
                        <img src="fig/JupyterLab软件02.png" alt="JupyterLab应用界面">
                        <div class="caption">图12：在"我的应用"中查看和访问JupyterLab</div>
                    </div>
                    
                    <h3 id="special-3">3. Rstudio-server使用教程</h3>
                    
                    <h4>（1）订阅Rstudio-server</h4>
                    <p>在应用中心订阅Rstudio-server服务。</p>
                    
                    <h4>（2）配置Rstudio-server作业</h4>
                    <p>在HPC工作台点击Rstudio-server应用图标，需要配置以下参数：</p>
                    
                    <p><strong>选择R路径：</strong></p>
                    <ul>
                        <li>可以使用默认R路径</li>
                        <li>也可以选择自己的R路径</li>
                    </ul>
                    
                    <p><strong>如何获取自己的R路径：</strong></p>
                    <ol>
                        <li>在命令行中使用<code>which R</code>命令找到R的绝对路径</li>
                        <li>例如：<code>/var/ty-root/users/TY_SHARED_DIR/share/software/miniconda3/envs/common/bin/R</code></li>
                        <li>在选择R路径时，需要将<strong>bin</strong>替换为<strong>lib</strong></li>
                        <li>例如：<code>/var/ty-root/users/TY_SHARED_DIR/share/software/miniconda3/envs/common/lib/R</code></li>
                    </ol>
                    
                    <p><strong>其他配置参数：</strong></p>
                    <ul>
                        <li><strong>登录密码：</strong>设置Rstudio-server的登录密码</li>
                        <li><strong>选择分区：</strong>选择适合的计算分区</li>
                        <li><strong>CPU数量：</strong>指定需要的CPU核心数</li>
                        <li><strong>内存数量：</strong>指定需要的内存大小</li>
                        <li><strong>运行时限：</strong>设置Rstudio-server的运行时间</li>
                        <li><strong>作业副本数：</strong>设置作业副本数量（默认为1）</li>
                    </ul>
                    
                    <p>所有参数配置完成后，点击提交按钮：</p>
                    
                    <div class="image-container">
                        <img src="fig/Rstudio-server软件01.png" alt="Rstudio-server配置界面">
                        <div class="caption">图13：Rstudio-server配置界面</div>
                    </div>
                    
                    <div class="image-container">
                        <img src="fig/Rstudio-server软件02.png" alt="Rstudio-server路径选择">
                        <div class="caption">图14：Rstudio-server路径选择和参数配置</div>
                    </div>
                    
                    <h4>（3）启动并登录Rstudio-server</h4>
                    <p>等待3-5分钟，在HPC工作台的"我的应用"中即可看到Rstudio-server应用，点击进入后：</p>
                    
                    <ol>
                        <li>输入当前用户账号</li>
                        <li>输入在配置时填写的登录密码</li>
                        <li>点击登录即可进入Rstudio-server工作环境</li>
                    </ol>
                    
                    <div class="image-container">
                        <img src="fig/Rstudio-server软件03.png" alt="Rstudio-server登录界面">
                        <div class="caption">图15：Rstudio-server登录界面</div>
                    </div>
                    
                    <div class="alert">
                        <i class="fas fa-lightbulb"></i>
                        <p><strong>提示：</strong> JupyterLab和Rstudio-server都是交互式开发环境，适用于数据分析和可视化工作。请根据您的实际需求选择合适的工具。</p>
                    </div>
					
                    <h3 id="special-4">4. alphagenome使用示例</h3>
                    
                    <h4>（1）使用官方API（推荐需要计算速度的用户）</h4>
                    <p>如果需要高速计算，请使用官方推荐的API进行运算。</p>
                    <p>参考：<a href="https://github.com/google-deepmind/alphagenome" class="software-link" target="_blank">https://github.com/google-deepmind/alphagenome</a></p>
                    
                    <h4>（2）使用Kaggle账号下载</h4>
                    <p>如果没有Google账号，但是有Kaggle账号的用户，可以使用官方推荐的下载方式。</p>
                    <p>参考：<a href="https://github.com/google-deepmind/alphagenome_research" class="software-link" target="_blank">https://github.com/google-deepmind/alphagenome_research</a></p>
                    
                    <h4>（3）本地运行</h4>
                    <p>为没有账号的用户提供和<a href="https://github.com/google-deepmind/alphagenome_research" class="software-link" target="_blank">https://github.com/google-deepmind/alphagenome_research</a>一致的运算结果。</p>
                    
                    <h4>（3.1） 命令行本地调用alphagenome环境</h4>
                    <p>执行以下命令：</p>
                    
                    <div class="code-block">
                        <pre><span class="comment"># 激活conda环境</span>
<span class="command">source</span> <span class="path">/var/ty-root/users/software/miniconda3/bin/activate</span>
<span class="comment"># 加载alphagenome模块</span>
<span class="command">module</span> load alphagenome
<span class="comment"># 激活alphagenome环境</span>
<span class="command">conda</span> activate alphagenome
<span class="comment"># 安装ipykernel</span>
<span class="command">python</span> -m ipykernel install --user --name=alphagenome --display-name alphagenome</pre>
                    </div>
                    
                    <p>出现和下图一样的输出表明调用成功：</p>
                    
                    <div class="image-container">
                        <img src="fig/alphagenome使用01.png" alt="alphagenome命令行调用成功">
                        <div class="caption">图16：alphagenome命令行调用成功界面</div>
                    </div>
                    
                    <h4>（3.2） 使用平台中的Jupyter启动alphagenome环境</h4>
                    <p>在JupyterLab配置界面，选择以下参数：</p>
                    <ul>
                        <li><strong>分区选择：</strong>x86-gpu</li>
                        <li><strong>加速卡选择：</strong>gpu:L20，并选择数量</li>
                    </ul>
                    
                    <div class="image-container">
                        <img src="fig/alphagenome使用02.png" alt="JupyterLab配置GPU">
                        <div class="caption">图17：JupyterLab配置GPU参数界面</div>
                    </div>
                    
                    <p>进入JupyterLab界面，在上方notebook选择alphagenome环境打开：</p>
                    
                    <div class="image-container">
                        <img src="fig/alphagenome使用03.png" alt="JupyterLab选择alphagenome环境">
                        <div class="caption">图18：JupyterLab选择alphagenome环境</div>
                    </div>
                    
                    <h4>（3.3） 调用alphagenome软件包</h4>
                    
                    <div class="code-block">
                        <pre><span class="keyword">from</span> alphagenome.data <span class="keyword">import</span> genome
<span class="keyword">from</span> alphagenome.visualization <span class="keyword">import</span> plot_components
<span class="keyword">from</span> alphagenome_research.model <span class="keyword">import</span> dna_model
<span class="keyword">from</span> alphagenome_research.model.dna_model <span class="keyword">import</span> OrganismSettings, Organism
<span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</pre>
                    </div>
                    
                    <div class="image-container">
                        <img src="fig/alphagenome使用04.png" alt="调用alphagenome软件包">
                        <div class="caption">图19：调用alphagenome软件包界面</div>
                    </div>
                    
                    <h4>（3.4） 使用本地权重和参考数据</h4>
                    
                    <div class="code-block">
                        <pre><span class="comment"># 设置参考数据和权重路径</span>
REF = <span class="path">"/var/ty-root/users/TY_SHARED_DIR/alphagenome_weight/models/google/alphagenome/jax/all_folds/reference"</span>
CKPT = <span class="path">"/var/ty-root/users/TY_SHARED_DIR/alphagenome_weight/models/google/alphagenome/jax/all_folds/1"</span>

organism_settings = {
    Organism.HOMO_SAPIENS: OrganismSettings(
        fasta_path=<span class="path">f"{REF}/GRCh38.p13.genome.fa"</span>,
        gtf_feather_path=<span class="path">f"{REF}/gencode.v46.annotation.gtf.gz.feather"</span>,
        pas_feather_path=<span class="path">f"{REF}/polyadb_human_v3_exon3_contiguous_gtfv46.feather"</span>,
        splice_site_starts_feather_path=<span class="path">f"{REF}/gencode.v46.splice_sites_starts.feather"</span>,
        splice_site_ends_feather_path=<span class="path">f"{REF}/gencode.v46.splice_sites_ends.feather"</span>,
    ),
    Organism.MUS_MUSCULUS: OrganismSettings(
        fasta_path=<span class="path">f"{REF}/GRCm38.p6.genome.fa"</span>,
        gtf_feather_path=<span class="path">f"{REF}/gencode.vM23.annotation.gtf.gz.feather"</span>,
        pas_feather_path=<span class="keyword">None</span>,
        splice_site_starts_feather_path=<span class="path">f"{REF}/gencode.vM38.splice_sites_starts.feather"</span>,
        splice_site_ends_feather_path=<span class="path">f"{REF}/gencode.vM38.splice_sites_ends.feather"</span>,
    ),
}</pre>
                    </div>
                    
                    <div class="image-container">
                        <img src="fig/alphagenome使用05.png" alt="设置本地权重和参考数据">
                        <div class="caption">图20：设置本地权重和参考数据界面</div>
                    </div>
                    
                    <h4>（3.5） 构建模型并使用（参考官方示例）</h4>
                    
                    <div class="code-block">
                        <pre><span class="comment"># 创建模型</span>
model = dna_model.create(
    checkpoint_path=CKPT,
    organism_settings=organism_settings
)

<span class="comment"># 定义基因组区间和变异</span>
interval = genome.Interval(chromosome=<span class="path">'chr22'</span>, start=<span class="path">35677410</span>, end=<span class="path">36725986</span>)
variant = genome.Variant(
    chromosome=<span class="path">'chr22'</span>,
    position=<span class="path">36201698</span>,
    reference_bases=<span class="path">'A'</span>,
    alternate_bases=<span class="path">'C'</span>,
)

<span class="comment"># 进行预测</span>
outputs = model.predict_variant(
    interval=interval,
    variant=variant,
    ontology_terms=[<span class="path">'UBERON:0001157'</span>],
    requested_outputs=[dna_model.OutputType.RNA_SEQ],
)</pre>
                    </div>
                    
                    <div class="image-container">
                        <img src="fig/alphagenome使用06.png" alt="构建模型并进行预测">
                        <div class="caption">图21：构建模型并进行预测界面</div>
                    </div>
                    
                    <h4>（3.6） 画图</h4>
                    
                    <div class="code-block">
                        <pre><span class="comment"># 绘制结果图</span>
plot_components.plot(
    [
        plot_components.OverlaidTracks(
            tdata={
                <span class="path">'REF'</span>: outputs.reference.rna_seq,
                <span class="path">'ALT'</span>: outputs.alternate.rna_seq,
            },
            colors={<span class="path">'REF'</span>: <span class="path">'dimgrey'</span>, <span class="path">'ALT'</span>: <span class="path">'red'</span>},
        ),
    ],
    interval=outputs.reference.rna_seq.interval.resize(2**15),
    <span class="comment"># 在图中标注变异位置为垂直线</span>
    annotations=[plot_components.VariantAnnotation([variant], alpha=<span class="path">0.8</span>)],
)</pre>
                    </div>
                    
                    <div class="image-container">
                        <img src="fig/alphagenome使用07.png" alt="绘制预测结果图">
                        <div class="caption">图22：绘制预测结果图界面</div>
                    </div>
					
					<div class="alert warning">
						<i class="fas fa-exclamation-triangle"></i>
						<div>
							<p><strong>重要警告：</strong> 运算结束以后：</p>
							<ul style="margin-left: 1.5rem; margin-top: 0.5rem; color: #742a2a;">
								<li>一定要"在jupyter界面restart kernal"，不可以直接关闭jupyterlab！</li>
								<li>一定要"在jupyter界面restart kernal"，不可以直接关闭jupyterlab！</li>
								<li>一定要"在jupyter界面restart kernal"，不可以直接关闭jupyterlab！</li>
							</ul>
							<p style="margin-top: 0.5rem;">否则，会一直占用GPU资源，无法释放！！</p>
						</div>
					</div>
					
                </div>
            </div>

            <div class="nav-links">
                <a href="software_list.html" class="nav-link">
                    <i class="fas fa-server"></i> 查看软件列表
                </a>
                <a href="index.html" class="nav-link">
                    <i class="fas fa-home"></i> 返回主界面
                </a>
            </div>

            <div class="footer">
                <strong>国家家养动物种质资源库 HPC 平台</strong> | 科研专用 | 版本 v1.2.0<br>
                技术支持：xxx团队 | 邮箱：xxx@xxx
            </div>
        </div>

        <!-- 目录容器 - 只占用小部分宽度 -->
        <div class="toc-container">
            <div class="toc-title">
                <i class="fas fa-list"></i> 快速导航
            </div>
            <ul class="toc-list">
                <li class="toc-item main" data-target="section-register">
                    <a href="#section-register" class="toc-link">
                        <i class="fas fa-user-plus"></i> 一、新用户注册
                    </a>
                </li>
                <li class="toc-item sub" data-target="register-1">
                    <a href="#register-1" class="toc-link">
                        <i class="fas fa-chevron-right"></i> 1. 访问登录注册界面
                    </a>
                </li>
                <li class="toc-item sub" data-target="register-2">
                    <a href="#register-2" class="toc-link">
                        <i class="fas fa-chevron-right"></i> 2. 填写注册信息
                    </a>
                </li>
                
                <li class="toc-item main" data-target="section1">
                    <a href="#section1" class="toc-link">
                        <i class="fas fa-sign-in-alt"></i> 二、用户登录
                    </a>
                </li>
                <li class="toc-item sub" data-target="login-1">
                    <a href="#login-1" class="toc-link">
                        <i class="fas fa-chevron-right"></i> 1. 访问登录界面
                    </a>
                </li>
                <li class="toc-item sub" data-target="login-2">
                    <a href="#login-2" class="toc-link">
                        <i class="fas fa-chevron-right"></i> 2. 查看用户信息
                    </a>
                </li>
                <li class="toc-item sub" data-target="login-3">
                    <a href="#login-3" class="toc-link">
                        <i class="fas fa-chevron-right"></i> 3. 切换到HPC工作台
                    </a>
                </li>
                <li class="toc-item sub" data-target="login-4">
                    <a href="#login-4" class="toc-link">
                        <i class="fas fa-chevron-right"></i> 4. 订阅所需软件
                    </a>
                </li>
                
                <li class="toc-item main" data-target="section2">
                    <a href="#section2" class="toc-link">
                        <i class="fas fa-terminal"></i> 三、网页平台提交命令
                    </a>
                </li>
                <li class="toc-item sub" data-target="web-submit-1">
                    <a href="#web-submit-1" class="toc-link">
                        <i class="fas fa-chevron-right"></i> 1. 订阅科学计算模块
                    </a>
                </li>
                <li class="toc-item sub" data-target="web-submit-2">
                    <a href="#web-submit-2" class="toc-link">
                        <i class="fas fa-chevron-right"></i> 2. 提交计算命令
                    </a>
                </li>
                <li class="toc-item sub" data-target="web-submit-3">
                    <a href="#web-submit-3" class="toc-link">
                        <i class="fas fa-chevron-right"></i> 3. 配置计算资源
                    </a>
                </li>
                <li class="toc-item sub" data-target="web-submit-4">
                    <a href="#web-submit-4" class="toc-link">
                        <i class="fas fa-chevron-right"></i> 4. 提交任务
                    </a>
                </li>
                
                <li class="toc-item main" data-target="section3">
                    <a href="#section3" class="toc-link">
                        <i class="fas fa-terminal"></i> 四、命令行提交命令
                    </a>
                </li>
                <li class="toc-item sub" data-target="cli-1">
                    <a href="#cli-1" class="toc-link">
                        <i class="fas fa-chevron-right"></i> 1. SSH登录集群
                    </a>
                </li>
                <li class="toc-item sub" data-target="cli-2">
                    <a href="#cli-2" class="toc-link">
                        <i class="fas fa-chevron-right"></i> 2. 查看已安装软件
                    </a>
                </li>
                <li class="toc-item sub" data-target="cli-3">
                    <a href="#cli-3" class="toc-link">
                        <i class="fas fa-chevron-right"></i> 3. 使用sbatch提交命令
                    </a>
                </li>
                <li class="toc-item sub" data-target="cli-4">
                    <a href="#cli-4" class="toc-link">
                        <i class="fas fa-chevron-right"></i> 4. 提交作业脚本文件
                    </a>
                </li>
                
                <li class="toc-item main" data-target="section4">
                    <a href="#section4" class="toc-link">
                        <i class="fas fa-eye"></i> 五、命令运行情况查看
                    </a>
                </li>
                <li class="toc-item sub" data-target="monitor-1">
                    <a href="#monitor-1" class="toc-link">
                        <i class="fas fa-chevron-right"></i> 1. 网页端查看运行情况
                    </a>
                </li>
                <li class="toc-item sub" data-target="monitor-2">
                    <a href="#monitor-2" class="toc-link">
                        <i class="fas fa-chevron-right"></i> 2. 查看作业详细信息
                    </a>
                </li>
                
                <li class="toc-item main" data-target="section5">
                    <a href="#section5" class="toc-link">
                        <i class="fas fa-laptop-code"></i> 六、特殊软件使用教程
                    </a>
                </li>
                <li class="toc-item sub" data-target="special-1">
                    <a href="#special-1" class="toc-link">
                        <i class="fas fa-chevron-right"></i> 1. 已安装软件列表
                    </a>
                </li>
                <li class="toc-item sub" data-target="special-2">
                    <a href="#special-2" class="toc-link">
                        <i class="fas fa-chevron-right"></i> 2. JupyterLab使用
                    </a>
                </li>
                <li class="toc-item sub" data-target="special-3">
                    <a href="#special-3" class="toc-link">
                        <i class="fas fa-chevron-right"></i> 3. Rstudio-server使用
                    </a>
                </li>
                <li class="toc-item sub" data-target="special-4">
                    <a href="#special-4" class="toc-link">
                        <i class="fas fa-chevron-right"></i> 4. alphagenome使用示例
                    </a>
                </li>
            </ul>
            <div class="toc-back-to-top">
                <a href="#" id="back-to-top">
                    <i class="fas fa-arrow-up"></i> 返回顶部
                </a>
            </div>
        </div>
    </div>

    <!-- 图片放大模态框 -->
    <div id="imageModal" class="image-modal">
        <span class="modal-close" id="modalClose">&times;</span>
        <div class="loading-spinner" id="loadingSpinner">
            <i class="fas fa-spinner fa-spin"></i>
        </div>
        <img class="modal-content" id="modalImage">
        <div class="modal-caption" id="modalCaption"></div>
        <div class="modal-controls">
            <button class="control-btn" id="zoomInBtn" title="放大">
                <i class="fas fa-search-plus"></i>
            </button>
            <button class="control-btn" id="zoomOutBtn" title="缩小">
                <i class="fas fa-search-minus"></i>
            </button>
            <button class="control-btn" id="resetZoomBtn" title="重置">
                <i class="fas fa-sync-alt"></i>
            </button>
            <button class="control-btn" id="downloadBtn" title="下载图片">
                <i class="fas fa-download"></i>
            </button>
        </div>
    </div>

    <script>
        // 目录功能实现
        document.addEventListener('DOMContentLoaded', function() {
            const tocItems = document.querySelectorAll('.toc-item');
            const sections = document.querySelectorAll('.tutorial-section, h3[id]');
            const backToTop = document.getElementById('back-to-top');

            // 高亮当前章节
            function highlightCurrentSection() {
                let currentSection = '';
                const scrollPosition = window.scrollY + 100; // 偏移量确保在正确位置触发

                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    const sectionHeight = section.offsetHeight;

                    if (scrollPosition >= sectionTop && scrollPosition < sectionTop + sectionHeight) {
                        currentSection = section.id;
                    }
                });

                // 更新目录高亮
                tocItems.forEach(item => {
                    item.classList.remove('active');
                    if (item.getAttribute('data-target') === currentSection) {
                        item.classList.add('active');
                        
                        // 如果子项被激活，也激活对应的主项
                        if (item.classList.contains('sub')) {
                            const mainItem = item.closest('.toc-list').querySelector(`.toc-item.main[data-target="${currentSection.split('-')[0]}"]`);
                            if (mainItem) {
                                mainItem.classList.add('active');
                            }
                        }
                    }
                });
            }

            // 平滑滚动到目标位置
            function smoothScrollTo(targetId) {
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop - 80,
                        behavior: 'smooth'
                    });
                }
            }

            // 为目录项添加点击事件
            tocItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('data-target');
                    if (targetId) {
                        smoothScrollTo(targetId);
                    }
                });
            });

            // 返回顶部功能
            if (backToTop) {
                backToTop.addEventListener('click', function(e) {
                    e.preventDefault();
                    window.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });
                });
            }

            // 监听滚动事件，更新高亮
            window.addEventListener('scroll', highlightCurrentSection);

            // 初始调用，确保页面加载时高亮正确
            highlightCurrentSection();

            // 图片放大功能
            // 获取模态框元素
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const modalCaption = document.getElementById('modalCaption');
            const modalClose = document.getElementById('modalClose');
            const loadingSpinner = document.getElementById('loadingSpinner');
            
            // 控制按钮
            const zoomInBtn = document.getElementById('zoomInBtn');
            const zoomOutBtn = document.getElementById('zoomOutBtn');
            const resetZoomBtn = document.getElementById('resetZoomBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            
            let currentScale = 1;
            const scaleStep = 0.2;
            let isDragging = false;
            let startX, startY, translateX = 0, translateY = 0;
            
            // 为所有教程图片添加双击事件
            const tutorialImages = document.querySelectorAll('.tutorial-content img');
            
            tutorialImages.forEach(img => {
                // 添加双击事件
                img.addEventListener('dblclick', function(e) {
                    openModal(this);
                });
                
                // 添加标题提示
                img.title = "双击图片放大查看";
            });
            
            // 打开模态框
            function openModal(imgElement) {
                modal.style.display = 'block';
                loadingSpinner.style.display = 'block';
                modalImage.style.display = 'none';
                
                // 获取图片源和标题
                const imgSrc = imgElement.src;
                const caption = imgElement.parentElement.querySelector('.caption')?.textContent || '';
                
                // 预加载图片
                const preloadImg = new Image();
                preloadImg.onload = function() {
                    modalImage.src = imgSrc;
                    modalImage.style.display = 'block';
                    modalCaption.textContent = caption;
                    loadingSpinner.style.display = 'none';
                    
                    // 重置缩放和位置
                    resetZoom();
                    
                    // 设置下载链接
                    downloadBtn.onclick = function() {
                        const link = document.createElement('a');
                        link.href = imgSrc;
                        link.download = getFileNameFromUrl(imgSrc) || 'hpc_image';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    };
                };
                
                preloadImg.onerror = function() {
                    loadingSpinner.style.display = 'none';
                    modalCaption.textContent = '图片加载失败';
                };
                
                preloadImg.src = imgSrc;
            }
            
            // 关闭模态框
            modalClose.onclick = function() {
                modal.style.display = 'none';
            };
            
            // 点击模态框背景关闭
            modal.onclick = function(e) {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            };
            
            // ESC键关闭模态框
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && modal.style.display === 'block') {
                    modal.style.display = 'none';
                }
            });
            
            // 缩放功能
            function applyZoom() {
                modalImage.style.transform = `translate(-50%, -50%) scale(${currentScale}) translate(${translateX / currentScale}px, ${translateY / currentScale}px)`;
                
                // 如果缩放比例大于1，添加可拖动类
                if (currentScale > 1) {
                    modalImage.classList.add('zoomed');
                    modalImage.style.cursor = 'move';
                } else {
                    modalImage.classList.remove('zoomed');
                    modalImage.style.cursor = 'default';
                    resetPosition();
                }
            }
            
            function zoomIn() {
                if (currentScale < 3) {
                    currentScale += scaleStep;
                    applyZoom();
                }
            }
            
            function zoomOut() {
                if (currentScale > 0.5) {
                    currentScale -= scaleStep;
                    applyZoom();
                }
            }
            
            function resetZoom() {
                currentScale = 1;
                resetPosition();
                applyZoom();
            }
            
            function resetPosition() {
                translateX = 0;
                translateY = 0;
            }
            
            // 按钮事件
            zoomInBtn.onclick = zoomIn;
            zoomOutBtn.onclick = zoomOut;
            resetZoomBtn.onclick = resetZoom;
            
            // 鼠标滚轮缩放
            modalImage.addEventListener('wheel', function(e) {
                e.preventDefault();
                if (e.deltaY < 0) {
                    zoomIn();
                } else {
                    zoomOut();
                }
            });
            
            // 图片拖拽功能
            modalImage.addEventListener('mousedown', function(e) {
                if (currentScale > 1) {
                    isDragging = true;
                    startX = e.clientX - translateX;
                    startY = e.clientY - translateY;
                    modalImage.style.cursor = 'grabbing';
                }
            });
            
            document.addEventListener('mousemove', function(e) {
                if (!isDragging) return;
                
                translateX = e.clientX - startX;
                translateY = e.clientY - startY;
                applyZoom();
            });
            
            document.addEventListener('mouseup', function() {
                isDragging = false;
                if (currentScale > 1) {
                    modalImage.style.cursor = 'move';
                }
            });
            
            // 触摸设备支持
            let touchStartDistance = 0;
            let touchStartScale = 1;
            
            modalImage.addEventListener('touchstart', function(e) {
                if (e.touches.length === 2) {
                    // 双指触摸开始，记录初始距离和缩放比例
                    touchStartDistance = getTouchDistance(e.touches[0], e.touches[1]);
                    touchStartScale = currentScale;
                } else if (e.touches.length === 1 && currentScale > 1) {
                    // 单指触摸开始拖拽
                    isDragging = true;
                    startX = e.touches[0].clientX - translateX;
                    startY = e.touches[0].clientY - translateY;
                }
            });
            
            modalImage.addEventListener('touchmove', function(e) {
                e.preventDefault();
                
                if (e.touches.length === 2) {
                    // 双指缩放
                    const currentDistance = getTouchDistance(e.touches[0], e.touches[1]);
                    const scaleChange = currentDistance / touchStartDistance;
                    currentScale = Math.max(0.5, Math.min(3, touchStartScale * scaleChange));
                    applyZoom();
                } else if (e.touches.length === 1 && isDragging) {
                    // 单指拖拽
                    translateX = e.touches[0].clientX - startX;
                    translateY = e.touches[0].clientY - startY;
                    applyZoom();
                }
            });
            
            modalImage.addEventListener('touchend', function() {
                isDragging = false;
            });
            
            // 辅助函数：计算触摸点距离
            function getTouchDistance(touch1, touch2) {
                const dx = touch1.clientX - touch2.clientX;
                const dy = touch1.clientY - touch2.clientY;
                return Math.sqrt(dx * dx + dy * dy);
            }
            
            // 从URL提取文件名
            function getFileNameFromUrl(url) {
                return url.substring(url.lastIndexOf('/') + 1);
            }
        });
    </script>
</body>
</html>